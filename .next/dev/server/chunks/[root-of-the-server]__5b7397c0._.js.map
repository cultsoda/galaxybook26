{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/olim/Desktop/galaxybook26/app/api/sheets/route.ts"],"sourcesContent":["import { google } from \"googleapis\";\nimport { NextResponse } from \"next/server\";\n\nconst SPREADSHEET_ID = process.env.GOOGLE_SHEETS_SPREADSHEET_ID;\nconst SHEET_NAME = \"시트1\"; // 시트 이름 (기본값)\n\nasync function getGoogleSheetsClient() {\n  const auth = new google.auth.GoogleAuth({\n    credentials: {\n      client_email: process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,\n      private_key: process.env.GOOGLE_PRIVATE_KEY?.replace(/\\\\n/g, \"\\n\"),\n    },\n    scopes: [\"https://www.googleapis.com/auth/spreadsheets\"],\n  });\n\n  return google.sheets({ version: \"v4\", auth });\n}\n\n// GET: Sheets에서 데이터 읽기\nexport async function GET() {\n  try {\n    const sheets = await getGoogleSheetsClient();\n\n    const response = await sheets.spreadsheets.values.get({\n      spreadsheetId: SPREADSHEET_ID,\n      range: `${SHEET_NAME}!A2:D`, // 2행부터 끝까지 (헤더 제외)\n    });\n\n    const rows = response.data.values || [];\n\n    const prizes = rows.map((row) => ({\n      id: Number(row[0]),\n      name: row[1],\n      totalQty: Number(row[2]),\n      remainingQty: Number(row[3]),\n    }));\n\n    return NextResponse.json({ prizes });\n  } catch (error) {\n    console.error(\"Error reading from Google Sheets:\", error);\n    return NextResponse.json({ error: \"Failed to read data\" }, { status: 500 });\n  }\n}\n\n// PUT: Sheets에 데이터 쓰기\nexport async function PUT(request: Request) {\n  try {\n    const { prizes } = await request.json();\n    const sheets = await getGoogleSheetsClient();\n\n    const values = prizes.map((prize: any) => [\n      prize.id,\n      prize.name,\n      prize.totalQty,\n      prize.remainingQty,\n    ]);\n\n    await sheets.spreadsheets.values.update({\n      spreadsheetId: SPREADSHEET_ID,\n      range: `${SHEET_NAME}!A2:D`,\n      valueInputOption: \"RAW\",\n      requestBody: { values },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error(\"Error writing to Google Sheets:\", error);\n    return NextResponse.json(\n      { error: \"Failed to write data\" },\n      { status: 500 }\n    );\n  }\n}\n\n// POST: 당첨 로그 기록 추가\nexport async function POST(request: Request) {\n  try {\n    const { prizeName } = await request.json();\n    const sheets = await getGoogleSheetsClient();\n    const now = new Date().toLocaleString(\"ko-KR\", { timeZone: \"Asia/Seoul\" });\n\n    await sheets.spreadsheets.values.append({\n      spreadsheetId: SPREADSHEET_ID,\n      range: `당첨로그!A:B`,\n      valueInputOption: \"RAW\",\n      requestBody: {\n        values: [[now, prizeName]],\n      },\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    return NextResponse.json({ error: \"로그 기록 실패\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,iBAAiB,QAAQ,GAAG,CAAC,4BAA4B;AAC/D,MAAM,aAAa,OAAO,cAAc;AAExC,eAAe;IACb,MAAM,OAAO,IAAI,0LAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACtC,aAAa;YACX,cAAc,QAAQ,GAAG,CAAC,4BAA4B;YACtD,aAAa,QAAQ,GAAG,CAAC,kBAAkB,EAAE,QAAQ,QAAQ;QAC/D;QACA,QAAQ;YAAC;SAA+C;IAC1D;IAEA,OAAO,0LAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM;IAAK;AAC7C;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM;QAErB,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YACpD,eAAe;YACf,OAAO,GAAG,WAAW,KAAK,CAAC;QAC7B;QAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM,IAAI,EAAE;QAEvC,MAAM,SAAS,KAAK,GAAG,CAAC,CAAC,MAAQ,CAAC;gBAChC,IAAI,OAAO,GAAG,CAAC,EAAE;gBACjB,MAAM,GAAG,CAAC,EAAE;gBACZ,UAAU,OAAO,GAAG,CAAC,EAAE;gBACvB,cAAc,OAAO,GAAG,CAAC,EAAE;YAC7B,CAAC;QAED,OAAO,2KAAY,CAAC,IAAI,CAAC;YAAE;QAAO;IACpC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,2KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;AACF;AAGO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QACrC,MAAM,SAAS,MAAM;QAErB,MAAM,SAAS,OAAO,GAAG,CAAC,CAAC,QAAe;gBACxC,MAAM,EAAE;gBACR,MAAM,IAAI;gBACV,MAAM,QAAQ;gBACd,MAAM,YAAY;aACnB;QAED,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACtC,eAAe;YACf,OAAO,GAAG,WAAW,KAAK,CAAC;YAC3B,kBAAkB;YAClB,aAAa;gBAAE;YAAO;QACxB;QAEA,OAAO,2KAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,2KAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,QAAQ,IAAI;QACxC,MAAM,SAAS,MAAM;QACrB,MAAM,MAAM,IAAI,OAAO,cAAc,CAAC,SAAS;YAAE,UAAU;QAAa;QAExE,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACtC,eAAe;YACf,OAAO,CAAC,QAAQ,CAAC;YACjB,kBAAkB;YAClB,aAAa;gBACX,QAAQ;oBAAC;wBAAC;wBAAK;qBAAU;iBAAC;YAC5B;QACF;QAEA,OAAO,2KAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,OAAO,2KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAW,GAAG;YAAE,QAAQ;QAAI;IAChE;AACF"}}]
}